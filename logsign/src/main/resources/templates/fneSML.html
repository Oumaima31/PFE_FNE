<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiche de Notification d'Evénement (FNE)</title>
    <link rel="stylesheet" href="/css/stylesml.css">
    <!-- Utilisation de FontAwesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header class="navbar">
        <!-- Section météo à gauche -->
        <div id="meteo" class="meteo-card">
            <span id="meteo-icon"></span>
            <div class="meteo-info">
                <span id="meteo-temp"></span>
                <span id="meteo-description"></span>
            </div>
        </div>
        <div id="real-time" class="time-card">
            <span id="current-date"></span>
            <span id="current-time"></span>
        </div>
        <!-- Bouton pour les écrans mobiles -->
        <button class="navbar-toggle" onclick="toggleNavbar()">
            <span></span>
            <span></span>    
        </button>
        <nav class="navbar-container">
            <a class="navbar-item" href="/auth/historiqueSML">
                <i class="fas fa-history"></i>
                <span>Historique des FNE</span>
            </a>
            <a class="navbar-item" href="/auth/notificationSML">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
            </a>
            <!-- Bouton de déconnexion -->
            <a class="navbar-item" href="/auth/index" onclick="logout(); return false;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </a>
        </nav>
    </header>
    
    <div id="notification" class="notification">
        <span th:if="${message}" th:text="${message}" style="color: green;"></span>
        <span th:if="${error}" th:text="${error}" style="color: red;"></span>
    </div>
    
    <div class="form-container">
        <div class="title-container">
            <img src="/image/oacaLogo.jpg" alt="Logo"> 
            <h1>Fiche de Notification d'Evénement (FNE)</h1>
        </div>
        
        <!-- Formulaire avec method POST et action pour soumettre FNE -->
        <form action="/auth/submitFNE" method="POST">
            <div class="section type-selection">
                <!-- Types d'événements -->
                <div class="form-group">
                    <label for="type_evt">Type d'événement :</label>
                    <select id="type_evt" name="type_evt" onchange="updateRefGneNumber()" class="enhanced-select">
                        <option value="">Sélectionnez un type</option>
                        <option value="accident">Accident (ACCID)</option>
                        <option value="incident_grave">Incident grave (ING)</option>
                        <option value="incident">Incident (INC)</option>
                        <option value="evt_technique">Evenement Technique (EVT)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ref_gne">REF GNE :</label>
                    <select id="ref_gne" name="ref_gne" class="enhanced-select">
                        <!-- Les options seront générées dynamiquement par JavaScript -->
                    </select>
                </div>
            </div>
            
            <!-- Section 1: Informations générales -->
            <section class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2><i class="fas fa-info-circle"></i> 1. Informations générales / معلومات عامة</h2>
                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content">
                    <table>
                        <tr>
                            <td>1.1 Organisme concerné</td>
                            <td><input type="text" name="Organisme_concerné" id="Organisme_concerné" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>1.2 Date</td>
                            <td><input type="date" name="Date" id="Date" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>1.3 Heure UTC</td>
                            <td><input type="time" name="heure_UTC" id="heure_UTC" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>1.4 Lieu de l'événement</td>
                            <td><input type="text" name="Lieu_EVT" id="Lieu_EVT" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>1.5 Moyen de détection</td>
                            <td><input type="text" name="moyen_detection" id="moyen_detection" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>1.6 Impacts opérationnels</td>
                            <td><input type="text" name="impacts_operationnels" id="impacts_operationnels" class="enhanced-input"></td>
                        </tr>
                    </table>
                </div>
            </section>

            <!-- Section 2: Aéronef(s) concerné(s) -->
            <section class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2><i class="fas fa-plane"></i> 2. Aéronef(s) concerné(s) / الطارات المعنية</h2>
                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content">
                    <div class="table-responsive">
                        <table>
                            <tr>
                                <th></th>
                                <th>Indicatif et immatriculation</th>
                                <th>Code SSR</th>
                                <th>Type appareil</th>
                                <th>Règles de vol</th>
                                <th>Terrain départ</th>
                                <th>Terrain arrivée</th>
                                <th>Cap</th>
                                <th>Altitude/FL réel</th>
                                <th>Altitude/FL autorisé</th>
                                <th>Vitesse</th>
                            </tr>
                            <tr>
                                <td><strong>A:</strong></td>
                                <td>
                                    <input type="text" name="indicatif_immatricultion_A" id="indicatif_immatricultion_A" class="enhanced-input">
                                    <div id="indicatif_error_A" class="error-message" style="display: none; color: red; font-size: 0.8em;">
                                        Veuillez entrer un indicateur valide (4 caractères)
                                    </div>
                                </td>
                                <td>
                                    <input type="text" name="code_ssr_A" id="code_ssr_A" class="enhanced-input">
                                    <div id="ssr_error_A" class="error-message" style="display: none; color: red; font-size: 0.8em;">
                                        Veuillez entrer un code SSR valide (4 chiffres)
                                    </div>
                                </td>
                                <td><input type="text" name="type_appareil_A" id="type_appareil_A" class="enhanced-input"></td>
                                <td>
                                    <select name="regles_vol_A" id="regles_vol_A" class="enhanced-select">
                                        <option value=""></option>
                                        <option value="IFR">IFR</option>
                                        <option value="VFR">VFR</option>
                                        <option value="IFR/VFR">IFR/VFR</option>
                                        <option value="VFR/IFR">VFR/IFR</option>   
                                    </select>
                                </td>
                                <td><input type="text" name="terrain_depart_A" id="terrain_depart_A" class="enhanced-input"></td>
                                <td><input type="text" name="terrain_arrivée_A" id="terrain_arrivée_A" class="enhanced-input"></td>
                                <td><input type="text" name="cap_A" id="cap_A" class="enhanced-input"></td>
                                <td>
                                    <select name="altitude_reel_A" id="altitude_reel_A" class="enhanced-select">
                                        <option value=""></option>
                                        <option value="pied">pied</option>
                                        <option value="FL">FL</option>
                                        <option value="métre">métre</option>  
                                    </select>
                                </td>
                                <td>
                                    <select name="altitude_autorise_A" id="altitude_autorise_A" class="enhanced-select">
                                        <option value=""></option>
                                        <option value="pied">pied</option>
                                        <option value="FL">FL</option>
                                        <option value="métre">métre</option>  
                                    </select>
                                </td>
                                <td><input type="text" name="vitesse_A" id="vitesse_A" class="enhanced-input"></td>
                            </tr>
                           
                            <tr>
                                <td><strong>B:</strong></td>
    <td>
        <input type="text" name="indicatif_immatricultion_B" id="indicatif_immatricultion_B" class="enhanced-input">
        <div id="indicatif_error_B" class="error-message" style="display: none;">
            Veuillez entrer un indicateur valide (4 caractères)
        </div>
    </td>
    <td>
        <input type="text" name="code_ssr_B" id="code_ssr_B" class="enhanced-input">
        <div id="ssr_error_B" class="error-message" style="display: none;">
            Veuillez entrer un code SSR valide (4 chiffres)
        </div>
    </td>
    <td><input type="text" name="type_appareil_B" id="type_appareil_B" class="enhanced-input"></td>
    <td>
        <select name="regles_vol_B" id="regles_vol_B" class="enhanced-select">
            <option value=""></option>
            <option value="IFR">IFR</option>
            <option value="VFR">VFR</option>
            <option value="IFR/VFR">IFR/VFR</option>
            <option value="VFR/IFR">VFR/IFR</option>   
        </select>
    </td>
    <td><input type="text" name="terrain_depart_B" id="terrain_depart_B" class="enhanced-input"></td>
    <td><input type="text" name="terrain_arrivée_B" id="terrain_arrivée_B" class="enhanced-input"></td>
    <td><input type="text" name="cap_B" id="cap_B" class="enhanced-input"></td>
    <td>
        <select name="altitude_reel_B" id="altitude_reel_B" class="enhanced-select">
            <option value=""></option>
            <option value="pied">pied</option>
            <option value="FL">FL</option>
            <option value="métre">métre</option>  
        </select>
    </td>
    <td>
        <select name="altitude_autorise_B" id="altitude_autorise_B" class="enhanced-select">
            <option value=""></option>
            <option value="pied">pied</option>
            <option value="FL">FL</option>
            <option value="métre">métre</option>  
        </select>
    </td>
    <td><input type="text" name="vitesse_B" id="vitesse_B" class="enhanced-input"></td>
</tr>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Section 3: Nombre de victimes -->
            <section class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2><i class="fas fa-user-injured"></i> 3. Nombre estimatif des victimes (si disponible) / عدد الضحايا</h2>
                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content">
                    <table>
                        <tr>
                            <th>Passagers</th>
                            <th>Personnel</th>
                            <th>Equipage</th>
                            <th>Autre</th>
                        </tr>
                        <tr>
                            <td><input type="number" name="passagers" id="passagers" class="enhanced-input"></td>
                            <td><input type="number" name="personnel" id="personnel" class="enhanced-input"></td>
                            <td><input type="number" name="equipage" id="equipage" class="enhanced-input"></td>
                            <td><input type="number" name="autre" id="autre" class="enhanced-input"></td>
                        </tr>
                    </table>
                </div>
            </section>

            <!-- Section 4: Conditions météorologiques -->
            <section class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2><i class="fas fa-cloud-rain"></i> 4. Conditions météorologiques / الأحوال الجوية</h2>
                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content">
                    <table>
                        <tr>
                            <th>Vent</th>
                            <th>Visibilité</th>
                            <th>Nébulosité</th>
                            <th>Précipitation</th>
                            <th>Autres phénomènes</th>
                        </tr>
                        <tr>
                            <td>
                                <div class="input-with-icon">
                                    <i class="fas fa-compass"></i>
                                    <input type="text" name="vent_direction" id="vent_direction" placeholder="Direction" class="enhanced-input">
                                </div>
                                <div class="input-with-icon">
                                    <i class="fas fa-wind"></i>
                                    <input type="text" name="vent_vitesse" id="vent_vitesse" placeholder="Vitesse" class="enhanced-input">
                                </div>
                            </td>
                            <td><input type="number" name="visibilite" id="visibilite" class="enhanced-input"></td>
                            <td>
                                <select name="nebulosite" id="nebulosite" class="enhanced-select">
                                    <option value=""></option>
                                    <option value="BKN">BKN</option>
                                    <option value="SCT">SCT</option>
                                    <option value="FEW">FEW</option>
                                    <option value="SKC">SKC</option>
                                    <option value="CB">CB</option>
                                </select>
                            </td>
                            <td>
                                <select name="precipitation" id="precipitation" class="enhanced-select">
                                    <option value=""></option>
                                    <option value="Pluie">Pluie</option>
                                    <option value="Grêle">Grêle</option>
                                    <option value="Neige">Neige</option>
                                </select>
                            </td>
                            <td><input type="text" name="autres_phenomenes" id="autres_phenomenes" class="enhanced-input"></td>
                        </tr>
                    </table>
                </div>
            </section>

            <!-- Section 5: Matériel, installation ou équipement -->
            <section class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2><i class="fas fa-tools"></i> 5. Matériel, installation ou équipement / معدات أو تجهيزات أو أجهزة</h2>
                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content">
                    <table>
                        <tr>
                            <td>L'événement implique une installation/équipement</td>
                            <td class="radio-group">
                                <label class="radio-label"><input type="radio" name="evt_implique_installation_équipement" value="true"> Oui</label>
                                <label class="radio-label"><input type="radio" name="evt_implique_installation_équipement" value="false" checked> Non</label>
                            </td>
                        </tr>
                        <tr>
                            <td>Le type de l'installation ou de l'équipement</td>
                            <td><input type="text" name="type_installation_équipement" id="type_installation_équipement" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>Le nom de la compagnie d'assistance / organisme exploitant le véhicule</td>
                            <td><input type="text" name="nom_compagnie_assistance_organisme_exploitant_véhicule" id="nom_compagnie_assistance_organisme_exploitant_véhicule" class="enhanced-input"></td>
                        </tr>
                        <tr>
                            <td>L'événement implique un véhicule ou un matériel d'assistance au sol</td>
                            <td class="radio-group">
                                <label class="radio-label"><input type="radio" name="evt_implique_véhicule_materiel_assistance_sol" value="true"> Oui</label>
                                <label class="radio-label"><input type="radio" name="evt_implique_véhicule_materiel_assistance_sol" value="false" checked> Non</label>
                            </td>
                        </tr>
                        <tr>
                            <td>Type du matériel / véhicule</td>
                            <td><input type="text" name="type_materiel_véhicule" id="type_materiel_véhicule" class="enhanced-input"></td>
                        </tr>
                    </table>
                </div>
            </section>

            <!-- Section 6: Description de l'événement -->
            <section class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <h2><i class="fas fa-file-alt"></i> 6. Description de l'événement (croquis si nécessaire) / وصف الحدث</h2>
                    <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content">
                    <textarea name="description_evt" rows="10" cols="100" id="description_evt" class="enhanced-textarea"></textarea>
                </div>
            </section>            
            <!-- Bouton de soumission -->
            <div class="button-container">
                <button type="submit" class="submit-button">
                    <i class="fas fa-paper-plane"></i> Soumettre
                </button>
            </div>
        </form>
    </div>
       
    <footer class="footer">
        <div class="footer-content">
            <p>
                La Fiche de Notification d'Evénement (FNE) est un document utilisé pour signaler et enregistrer les événements liés à la sécurité aérienne. Elle permet de collecter des informations précises pour analyser et prévenir les incidents futurs.
            </p>
            <div class="contact-info">
                <p>
                    <i class="fab fa-whatsapp"></i>
                    <span>Contactez-nous sur WhatsApp :</span>
                    <a href="https://wa.me/1234567890" target="_blank">+123 456 7890</a>
                </p>
                <p>
                    <i class="fas fa-globe"></i>
                    <span>Visitez le site web de l'OACA :</span>
                    <a href="https://www.oaca.nat.tn/" target="_blank">www.oaca.ma</a>
                </p>
            </div>
        </div>
    </footer>

    <script src="/js/scriptsml.js"></script>
    <script>
        // Mettre à jour la date et l'heure toutes les secondes
        setInterval(updateDateTime, 1000);
        // Afficher la date et l'heure immédiatement au chargement de la page
        updateDateTime();
        // Afficher Meteo
        fetchMeteo();
        
        // Ouvrir la première section par défaut
        document.addEventListener('DOMContentLoaded', function() {
            // Ouvrir la première section
            const firstSection = document.querySelector('.collapsible-section');
            if (firstSection) {
                toggleSection(firstSection.querySelector('.section-header'));
            }
        });
    </script>
</body>
</html>